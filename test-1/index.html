<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web Map</title>
  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { position: absolute; inset: 0; }
    .panel {
      position: absolute;
      z-index: 2;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 16px rgba(0,0,0,.12);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .legend { bottom: 16px; left: 16px; padding: 10px 12px; font-size: 12px; line-height: 1.35; max-width: 320px; }
    .legend h4 { margin: 0 0 6px; font-size: 13px; }
    .controls { top: 16px; right: 16px; padding: 8px 10px; font-size: 12px; }
    .controls button {
      appearance: none; border: 1px solid #e5e7eb; border-radius: 8px; padding: 6px 10px; margin: 0 4px 4px 0;
      background: #fff; cursor: pointer;
    }
    .controls button:hover { background: #f9fafb; }
    .hidden { display: none; }
    .popup { font: 12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="panel controls" role="region" aria-label="Map controls">
    <button id="fit">Fit to Data</button>
    <button id="toggle">Toggle Points</button>
    <button id="reset">Reset View</button>
  </div>

  <div class="panel legend" id="legend" role="region" aria-label="Legend">
    <h4>Demo Points</h4>
    Click a point for details. Use the buttons to fit to data or toggle visibility.
  </div>

  <script>
    // ====== REQUIRED: your token & style ======
    mapboxgl.accessToken = 'pk.eyJ1IjoidGV0b250b3BvIiwiYSI6ImNtNm1jYzR1NzA1a2IybW83eGlkbnh5cjgifQ.i6aEqbk61S5evIU0zNFGpg';
    const STYLE_URL = 'mapbox://styles/tetontopo/cme31qvvn01jm01qp94v07glw';

    // ====== Map init (clean UI) ======
    const initial = { center: [-122.119, 43.338], zoom: 5.6 };
    const map = new mapboxgl.Map({
      container: 'map',
      style: STYLE_URL,
      center: initial.center,
      zoom: initial.zoom,
      hash: true // shareable view in URL
    });

    // Built-in minimal controls
    map.addControl(new mapboxgl.NavigationControl({ visualizePitch: true }), 'top-left');
    map.addControl(new mapboxgl.FullscreenControl(), 'top-left');
    map.addControl(new mapboxgl.ScaleControl({ maxWidth: 180, unit: 'imperial' }));
    map.addControl(new mapboxgl.GeolocateControl({
      positionOptions: { enableHighAccuracy: true },
      trackUserLocation: true,
      showUserHeading: true
    }));

    // ====== Demo data (replace with your own) ======
    const demoGeoJSON = {
      "type": "FeatureCollection",
      "features": [
        { "type": "Feature",
          "properties": { "name": "Sample A", "desc": "Hello from point A" },
          "geometry": { "type": "Point", "coordinates": [-122.119, 43.338] }
        },
        { "type": "Feature",
          "properties": { "name": "Sample B", "desc": "Another clickable point" },
          "geometry": { "type": "Point", "coordinates": [-121.7, 43.6] }
        },
        { "type": "Feature",
          "properties": { "name": "Sample C", "desc": "Yet another place" },
          "geometry": { "type": "Point", "coordinates": [-122.6, 43.0] }
        }
      ]
    };

    // Compute bounds for Fit button
    const dataBounds = new mapboxgl.LngLatBounds();
    for (const f of demoGeoJSON.features) {
      dataBounds.extend(f.geometry.coordinates);
    }

    map.on('load', () => {
      // Add source
      map.addSource('points', { type: 'geojson', data: demoGeoJSON });

      // Circle layer
      map.addLayer({
        id: 'points-circle',
        type: 'circle',
        source: 'points',
        paint: {
          'circle-radius': 6,
          'circle-color': '#1e90ff',
          'circle-stroke-width': 1,
          'circle-stroke-color': '#ffffff'
        }
      });

      // Labels
      map.addLayer({
        id: 'points-label',
        type: 'symbol',
        source: 'points',
        layout: {
          'text-field': ['get', 'name'],
          'text-offset': [0, 1.1],
          'text-size': 12,
          'text-allow-overlap': false
        },
        paint: {
          'text-halo-color': '#ffffff',
          'text-halo-width': 1.2
        }
      });
    });

    // ====== Popups ======
    const popup = new mapboxgl.Popup({ closeButton: false, closeOnClick: false });
    map.on('mouseenter', 'points-circle', () => map.getCanvas().style.cursor = 'pointer');
    map.on('mouseleave', 'points-circle', () => { map.getCanvas().style.cursor = ''; popup.remove(); });
    map.on('click', 'points-circle', (e) => {
      const f = e.features && e.features[0];
      if (!f) return;
      const coords = f.geometry.coordinates.slice();
      const html = `<div class="popup"><strong>${f.properties.name}</strong><br>${f.properties.desc}</div>`;
      popup.setLngLat(coords).setHTML(html).addTo(map);
    });

    // ====== Buttons ======
    const fitBtn = document.getElementById('fit');
    const toggleBtn = document.getElementById('toggle');
    const resetBtn = document.getElementById('reset');
    let visible = true;

    fitBtn.addEventListener('click', () => {
      if (!dataBounds.isEmpty()) map.fitBounds(dataBounds, { padding: 48, duration: 700 });
    });
    toggleBtn.addEventListener('click', () => {
      visible = !visible;
      const v = visible ? 'visible' : 'none';
      if (map.getLayer('points-circle')) map.setLayoutProperty('points-circle', 'visibility', v);
      if (map.getLayer('points-label')) map.setLayoutProperty('points-label', 'visibility', v);
    });
    resetBtn.addEventListener('click', () => {
      map.flyTo({ center: initial.center, zoom: initial.zoom, pitch: 0, bearing: 0, duration: 700 });
    });

    // ====== Swap in your own data later ======
    // Example: hosted GeoJSON
    // map.addSource('my-data', { type: 'geojson', data: 'https://yourdomain/path/data.geojson' });
    // map.addLayer({ id: 'my-points', type: 'circle', source: 'my-data', paint: { 'circle-radius': 5, 'circle-color': '#e76f51' } });
  </script>
</body>
</html>

